<div class="max-w-3xl mx-auto space-y-6">
  <div class="flex items-center justify-between">
    <h1 class="text-3xl font-bold text-gray-900">
      {{ isEditMode ? 'Editar Reporte' : 'Nuevo Reporte de Sesión' }}
    </h1>
    <a routerLink="/session-reports" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
      ← Volver
    </a>
  </div>

  @if (isLoading()) {
    <app-loading message="Guardando..." />
  } @else {
    <form [formGroup]="reportForm" (ngSubmit)="onSubmit()" class="bg-white rounded-lg shadow-md p-6 space-y-6">
      @if (error()) {
        <app-error-display [message]="error()!" />
      }

      <div>
        <label for="careSessionId" class="block text-sm font-medium text-gray-700">Sesión *</label>
        <select id="careSessionId" formControlName="careSessionId" [class.border-red-300]="careSessionId?.invalid && careSessionId?.touched"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
          <option value="">Selecciona una sesión</option>
          @for (session of sessions(); track session.id) {
            <option [value]="session.id">{{ session.id }} - {{ session.petId }}</option>
          }
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Actividades *</label>
        <div formArrayName="activities" class="space-y-2">
          @for (activity of activities.controls; track $index) {
            <div class="flex gap-2">
              <input [formControlName]="$index" type="text" placeholder="Actividad"
                class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" />
              @if (activities.length > 1) {
                <button type="button" (click)="removeActivity($index)"
                  class="px-3 py-1 text-sm text-red-600 border border-red-300 rounded-md hover:bg-red-50">Eliminar</button>
              }
            </div>
          }
        </div>
        <button type="button" (click)="addActivity()" class="mt-2 px-3 py-1 text-sm text-indigo-600 border border-indigo-300 rounded-md hover:bg-indigo-50">
          + Agregar Actividad
        </button>
      </div>

      <div>
        <label for="notes" class="block text-sm font-medium text-gray-700">Notas *</label>
        <textarea id="notes" formControlName="notes" rows="4" [class.border-red-300]="notes?.invalid && notes?.touched"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></textarea>
      </div>

      <div>
        <label for="mood" class="block text-sm font-medium text-gray-700">Estado de Ánimo</label>
        <select id="mood" formControlName="mood"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
          <option value="">Selecciona</option>
          <option value="happy">Feliz</option>
          <option value="calm">Tranquilo</option>
          <option value="anxious">Ansioso</option>
          <option value="playful">Juguetón</option>
          <option value="tired">Cansado</option>
        </select>
      </div>

      <div formGroupName="feeding" class="border border-gray-200 rounded-lg p-4">
        <h3 class="text-sm font-medium text-gray-700 mb-3">Alimentación</h3>
        <div class="grid grid-cols-3 gap-4">
          <div>
            <label class="block text-xs text-gray-600">Hora</label>
            <input formControlName="time" type="time" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" />
          </div>
          <div>
            <label class="block text-xs text-gray-600">Cantidad</label>
            <input formControlName="amount" type="text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" />
          </div>
          <div>
            <label class="block text-xs text-gray-600">Tipo</label>
            <input formControlName="foodType" type="text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" />
          </div>
        </div>
      </div>

      <div formGroupName="medication" class="border border-gray-200 rounded-lg p-4">
        <h3 class="text-sm font-medium text-gray-700 mb-3">Medicación</h3>
        <div class="grid grid-cols-3 gap-4">
          <div>
            <label class="block text-xs text-gray-600">Hora</label>
            <input formControlName="time" type="time" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" />
          </div>
          <div>
            <label class="block text-xs text-gray-600">Medicamento</label>
            <input formControlName="medication" type="text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" />
          </div>
          <div>
            <label class="block text-xs text-gray-600">Dosis</label>
            <input formControlName="dosage" type="text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" />
          </div>
        </div>
      </div>

      <div class="flex justify-end space-x-3">
        <button type="button" routerLink="/session-reports"
          class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50">Cancelar</button>
        <button type="submit" [disabled]="reportForm.invalid || isLoading()"
          class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50">{{ isEditMode ? 'Actualizar' : 'Crear' }}</button>
      </div>
    </form>
  }
</div>

